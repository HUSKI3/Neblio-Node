file(READ ${CMAKE_CURRENT_SOURCE_DIR}/config.ini.in test_config_in)
if(CONFIGURE_SYSTEM_TESTS)
    STRING(REPLACE "@abs_top_srcdir@"   "${CMAKE_SOURCE_DIR}" test_config_in "${test_config_in}" )
    STRING(REPLACE "@abs_top_builddir@" "${CMAKE_BINARY_DIR}" test_config_in "${test_config_in}" )
    if(WIN32)
        set(SYSTEST_EXEC_EXT "exe")
    elseif(APPLE)
        set(SYSTEST_EXEC_EXT "app")
    else()
        set(SYSTEST_EXEC_EXT "")
    endif()
    STRING(REPLACE "@EXEEXT@" "${SYSTEST_EXEC_EXT}" test_config_in "${test_config_in}" )
    set(SYSTEST_ENABLE_WALLET_TESTS ON)
    set(SYSTEST_ENABLE_UTIL_TESTS ON)
    set(SYSTEST_ENABLE_NEBLIOD_TESTS ON)
    set(SYSTEST_ENABLE_ZMQ_TESTS OFF)
    if(SYSTEST_ENABLE_WALLET_TESTS)
        STRING(REPLACE "@ENABLE_WALLET_TRUE@" "" test_config_in "${test_config_in}" )
    elseif(SYSTEST_ENABLE_WALLET_TESTS)
        STRING(REPLACE "@ENABLE_WALLET_TRUE@" "#" test_config_in "${test_config_in}" )
    endif()
    if(SYSTEST_ENABLE_UTIL_TESTS)
        STRING(REPLACE "@BUILD_BITCOIN_UTILS_TRUE@" "" test_config_in "${test_config_in}" )
    elseif(SYSTEST_ENABLE_WALLET_TESTS)
        STRING(REPLACE "@BUILD_BITCOIN_UTILS_TRUE@" "#" test_config_in "${test_config_in}" )
    endif()
    if(SYSTEST_ENABLE_NEBLIOD_TESTS)
        STRING(REPLACE "@BUILD_BITCOIND_TRUE@" "" test_config_in "${test_config_in}" )
    elseif(SYSTEST_ENABLE_WALLET_TESTS)
        STRING(REPLACE "@BUILD_BITCOIND_TRUE@" "#" test_config_in "${test_config_in}" )
    endif()
    if(SYSTEST_ENABLE_ZMQ_TESTS)
        STRING(REPLACE "@ENABLE_ZMQ_TRUE@" "" test_config_in "${test_config_in}" )
    elseif(SYSTEST_ENABLE_WALLET_TESTS)
        STRING(REPLACE "@ENABLE_ZMQ_TRUE@" "#" test_config_in "${test_config_in}" )
    endif()
    FILE(WRITE ${CMAKE_CURRENT_SOURCE_DIR}/config.ini "${test_config_in}")
endif()

